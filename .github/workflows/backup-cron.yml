name: Backup Batch Cron

on:
  schedule:
    # ë§¤ì¼ UTC 09:00 (í•œêµ­ì‹œê°„ 18:00) - Vercel í¬ë¡ ê³¼ ë™ì¼í•œ ì‹œê°„
    - cron: '0 9 * * *'
    # ë§¤ì¼ UTC 09:30 (í•œêµ­ì‹œê°„ 18:30) - ë°±ì—…ìš© (30ë¶„ í›„)
    - cron: '30 9 * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  backup-batch:
    runs-on: ubuntu-latest
    
    steps:
      - name: Trigger Marvel Batch
        run: |
          echo "ğŸš€ Starting backup batch execution..."
          
          # Vercel í¬ë¡ ê³¼ ë™ì¼í•œ í—¤ë”ë¡œ ìš”ì²­
          response=$(curl -s -w "%{http_code}" -o /tmp/response.json \
            -X POST https://patchlog.vercel.app/api/marvel-batch \
            -H "x-vercel-cron: 1" \
            -H "user-agent: vercel-cron/1.0")
          
          http_code="${response: -3}"
          
          echo "ğŸ“Š HTTP Status: $http_code"
          echo "ğŸ“‹ Response:"
          cat /tmp/response.json
          
          if [ "$http_code" -eq 200 ]; then
            echo "âœ… Batch execution successful!"
          else
            echo "âŒ Batch execution failed with status: $http_code"
            exit 1
          fi

      - name: Notify on failure
        if: failure()
        run: |
          echo "ğŸ”” Batch failed! Manual intervention required."
          echo "Check logs at: https://github.com/${{ github.repository }}/actions"